name: keepAlive

on:
  schedule:
    - cron: "10-59/20 0,8-23 * * *"
  workflow_dispatch:

jobs:
  call-api:
    runs-on: ubuntu-latest
    steps:
      - name: Tentar acordar o Render com retry
        run: |
          URL="https://chatbot-6viu.onrender.com/live"
          MAX_ATTEMPTS=10
          DELAY=15

          echo "Pingando o servidor: $URL"
          
          for ((i=1;i<=MAX_ATTEMPTS;i++)); do
            echo "Tentativa $i de $MAX_ATTEMPTS..."
            
            STATUS=$(curl -o /dev/null -s -w "%{http_code}" "$URL")

            if [ "$STATUS" -eq 200 ]; then
              echo "Servidor acordou! (200 OK)"
              exit 0
            fi

            echo "Resposta $STATUS â€” tentando novamente em ${DELAY}s..."
            sleep $DELAY
          done

          echo "Falhou apÃ³s $MAX_ATTEMPTS tentativas ðŸ˜¢"
          exit 1